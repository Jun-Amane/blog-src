<!doctype html>
<html
  lang="en-us"
  dir="ltr"
>
   <script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
></script>
<script>
  MathJax = {
    tex: {
      displayMath: [
        ["\\[", "\\]"],
        ["$$", "$$"],
      ], 
      inlineMath: [["\\(", "\\)"]], 
    },
    loader: {
      load: ["ui/safe"],
    },
  };
</script>
  <head>
  <meta charset="utf-8" />
  <title>
    Simple Open Source Security Key - 無何有之鄉
  </title>
  <meta
    name="description"
    content="Junの博客～技术与随笔的可爱小站~"
  />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <script src="https://cdn.jsdelivr.net/npm/google-fonts@1.0.0/index.min.js"></script>

  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Serif+SC:wght@600&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/out.css" type="text/css" />
  
  
  
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />

  
<link rel="stylesheet" href="/css/main.css" />
 
      <script src="/js/main.js"></script>

</head>

  <body class="bg-[#F8FBFF] text-gray-800 font-serif">
    
    
    <div class="flex min-h-screen max-w-screen-2xl mx-auto">
      
      <aside
  class="w-64 px-4 py-8 flex flex-col justify-between h-screen sticky top-0"
>
  
  <div class="space-y-6">
    <div>
      <h3 class="text-base tracking-wide mb-2 font-bold">
        <span class="font-serif text-my-ultramarine">zzy040330.</span
        ><span class="font-sans text-my-pink">萌え</span>
      </h3>

      <h1 class="text-4xl text-my-ultramarine tracking-wide mb-2 font-bold">
        無何有之鄉
      </h1>
      <p class="text-base text-gray-500">~本来无一物 何处惹尘埃~</p>
    </div>

    <nav class="text-xl space-y-2 text-my-ultramarine font-medium">
      <a href="/" class="block hover:text-my-pink">首页</a>
      <a href="/categories/" class="block hover:text-my-pink">分类</a>
      <a href="/tags/" class="block hover:text-my-pink">标签</a>
      <a href="/posts/" class="block hover:text-my-pink">归档</a>
      <a href="/about/" class="block hover:text-my-pink">关于</a>
    </nav>

    <a
      href="/index.xml"
      class="block text-sm text-my-ultramarine hover:text-my-pink"
      ><i class="fa-solid fa-rss"></i> RSS 订阅
    </a>
    
    <div class="text-lg mt-6 border-t border-gray-200 pt-4 text-sm space-y-2">
      <a
        href="https://orcid.org/0000-0002-7017-5397"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-brands fa-orcid"></i> ORCID
      </a>
      <a
        href="https://www.researchgate.net/profile/Ziyu-Zhou-36"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-brands fa-researchgate"></i> ResearchGate
      </a>
      <a
        href="https://github.com/Jun-Amane"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-brands fa-github"></i> GitHub
      </a>
      <a
        href="mailto:zzy040330@ieee.org"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-solid fa-envelope"></i> 学术邮箱
      </a>
      <a
        href="mailto:jun@zzy040330.moe"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-solid fa-envelope"></i> 个人邮箱
      </a>
      <a
        href="/ziyu_zhou_pubkey.asc"
        class="flex gap-2 text-my-ultramarine hover:text-my-pink"
      >
        <i class="fa-solid fa-key"></i> GPG 公钥
      </a>
    </div>
  </div>

  
  <footer class="text-xs text-gray-400 pt-6 border-t border-gray-200 mt-12">
    <p class="leading-relaxed">
      © 2013-2025 無何有之鄉 <br />
      <a href="https://creativecommons.org/licenses/by-sa/4.0/"
        >本站採用 CC BY-SA 4.0 許可證</a
      ><br />
      Designed by Jun & A.L.I.C.E.
    </p>
  </footer>
</aside>


      
      <main class="flex-1 px-6 py-12">
<article class="max-w-3xl mx-auto text-base leading-relaxed">
  
  <header class="mb-10">
    
    <p class="text-sm text-gray-500">2022-08-12 13:23</p>

    
    <h1 class="text-4xl font-bold text-my-ultramarine tracking-tight my-2">
      Simple Open Source Security Key
    </h1>

    
    
    <p class="text-lg text-gray-600">~An Open-Source OpenSK Security Key Based on Nodric nRF52840~</p>
    

    
    
    <p class="mt-4 text-gray-700 border-l-4 border-my-ultramarine pl-4">
      [Abstract] Using the Nordic nRF52840 Dongle development board in conjunction with the Google OpenSK project, creating an open-source, physical security key that supports the U2F FIDO and FIDO2 standards.
    </p>
    

    
    
    <div class="flex flex-wrap gap-2 mt-3">
      <span class="text-gray-700">Keywords: </span>
      
      <span
        class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine text-xs tracking-wide"
      >
        OpenSK
      </span>
      
      <span
        class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine text-xs tracking-wide"
      >
        Nordic nRF52840 Dongle
      </span>
      
      <span
        class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine text-xs tracking-wide"
      >
        Security
      </span>
      
    </div>
    

    
    <hr class="mt-6 border-[#a0c4ff]" />
  </header>

  
  <div class="prose prose-indigo max-w-none"><h3>序</h3>
<hr>
<p>  OpenSK是谷歌的开源安全密钥项目，以Rust编写，支持FIDO U2F与FIDO2标准。其项目文档中写明其支持Nordic nRF52840 Dongle开发板，手边正好有一枚闲置，故对此项目进行研究，以实现兼容FIDO2.1标准的物理安全密钥。
<br /></p>
<p><img src="device.png" alt="device">
<br /></p>
<p><img src="opensk1.PNG" alt="opensk">
<br />
<br /></p>
<h3>一、开发环境部署</h3>
<hr>
<p>  以Arch Linux系统演示。默认基本软件包（包括Python环境）已正确。
<a href="https://github.com/google/OpenSK/blob/stable/docs/install.md">官方文档中有关的链接</a></p>
<br />
&emsp;&emsp;安装Rustup，通过pacman。
<p><code>sudo pacman -S rutup</code>
<br /><br />
  通过pip3安装nrfutil（莫忘设置pip3所安装到的路径入PATH）。nrfutil是一个可以通过nordicdfu模式烧录开发板，若使用J-Tag等工具烧录则无需使用。</p>
<p><code>pip3 install nrfutil</code>
<br /><br />
  通过以下指令设置udev规则，以使非root用户可与OpenSK设备交互。</p>
<p><code>sudo cp rules.d/55-opensk.rules /etc/udev/rules.d/</code><br />
<code>sudo udevadm control --reload</code>
<br /><br />
  使用git命令将OpenSK仓库克隆至本地。此处使用develop分支以参与最新版本的开发与修复，若作为日常使用，推荐使用stable分支。</p>
<p><code>git clone git@github.com:Google/OpenSK -b develop</code>
<br /><br />
  进入OpenSK文件夹，使用</p>
<p><code>./setup.sh</code>进行安装前的设置。
<br /><br /></p>
<h3>二、部署</h3>
<hr>
<p>  
<a href="https://github.com/google/OpenSK/blob/stable/docs/boards/nrf52840_dongle.md">官方文档中的内容</a><br />
  使用如下命令编译并通过NordicDFU模式烧录固件。</p>
<p><code>./deploy.py --board=nrf52840_dongle_dfu --opensk --programmer=nordicdfu</code>
<br /><br />
  若从低版本升级到此固件，在烧录之前，需通过erase_storage模式擦出储存器，将上述命令中「&ndash;opensk」更换为「&ndash;erase_storage」并烧录即可。此后，再使用上述命令重新安装固件。<br />
  烧录完成后，通过此命令将证书配置入设备。似乎stable分支与develop分支中，烧录后会自动进行；develop分支中，烧录完成后会报错，说明无法配置设备，需要运行以下命令手动配置；而stable分支中无此问题，但运行以下命令后会报错。似乎不影响正常使用。<br /></p>
<p><code>./tools/configure.py \</code><br />
<code>    --certificate=crypto_data/opensk_cert.pem \</code><br />
<code>    --private-key=crypto_data/opensk.key</code></p>
<br />
<p><img src="flashing.PNG" alt="flashing">
<br /></p>
<p><img src="lsusb.PNG" alt="lsusb"></p>
<p><br /><br /></p>
<h3>三、使用与进一步设置</h3>
<hr>
<p>  经如上设置后，Google、Github、Microsoft等账户可以正常使用此安全密钥。OpenSSH可使用（非resident式）ecdsa-sk密钥进行ssh访问；对于此的进一步设置，将在下文提及。可在
<a href="https://demo.yubico.com/webauthn-technical/registration">Yubico Demo站点相关页面</a>进行安全密钥的测试。<br /></p>
<p><img src="test.PNG" alt="test">
<br /></p>
<p><img src="google-set.PNG" alt="google-set">
<br /></p>
<p><img src="ms-login.PNG" alt="ms-login">
<br />
  对于使用物理安全密钥进行Linux中的免密登、sudo等，可使用pam-u2f进行。具体信息参见
<a href="https://wiki.archlinux.org/title/Universal_2nd_Factor">Arch Linux Wiki中相关页面</a>。<br />
  对于配合OpenSSH的使用，Stable分支仅可使用非resident式ecdsa-sk算法的密钥进行ssh访问。而develop分支，可在部署时添加「&ndash;ed25519」参数，以添加对ed25519-sk算法的支持。<br />
  使用以下命令生成ed25519-sk算法的ssh符节。建议使用「-C」参数添加备注信息。</p>
<p><code>ssh-keygen -t ed25519-sk</code>
<br /><br />
  对于develop分支，近期的版本，支持resident式密钥，即将私钥保存入OpenSK设备，可在任何地方读取并使用。使用如下命令生成。</p>
<p><code>ssh-keygen -t ed25519-sk -O resident</code>
<br /><br />
  此时，输入安全密钥的PIN码后，私钥将保存其中。在新设备上，使用如下命令将ssh私钥添加入agent。</p>
<p><code>ssh-add -K</code>
<br /><br />
  会要求输入PIN码。
<br /></p>
<p><img src="ssh-add.PNG" alt="ssh-add">
<br /><br /></p>
<h3>fin、结</h3>
<hr>
<p>  此课题的研究实现了低成本的物理安全密钥的制作。而OpenSK项目本身存在诸多不完善之处，需要整个社区的努力，进行长期地维护，而这，便是「开源」的意义所在。
<br /></p>
<p><img src="working.png" alt="working">
<br />
<br /></p>
<p><i>Jun ASAKA</i>
<br />
<i>二〇二二年七月十九 火曜日</i></p></div>

  
  
<div class="mt-8 flex flex-wrap gap-2 text-sm">
  <a
    href="/tags/embedded-system/"
    class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine hover:bg-my-ultramarine/20 transition"
  >
    #Embedded System
  </a>
  <a
    href="/tags/mcu--boards/"
    class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine hover:bg-my-ultramarine/20 transition"
  >
    #MCU &amp; Boards
  </a>
  <a
    href="/tags/security/"
    class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine hover:bg-my-ultramarine/20 transition"
  >
    #Security
  </a>
  <a
    href="/tags/fidoctap/"
    class="px-3 py-1 rounded-full bg-my-ultramarine/10 text-my-ultramarine hover:bg-my-ultramarine/20 transition"
  >
    #FIDO&amp;CTAP
  </a>
</div>

</article>
</main>
    </div>
  </body>
</html>
